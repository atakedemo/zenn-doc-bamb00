---
title: "ç¬¬ã‚¼ãƒ­ç¨¿ ~AI Agent Hackathon with Google Cloudæå‡ºãƒ—ãƒ­ãƒ€ã‚¯ãƒˆ~"
emoji: "ğŸ› "
type: "tech" 
topics: ["GCP","Vertex AI", ","Cloud Run", "Firebase"]
published: true
---

# ç¬¬ã‚¼ãƒ­ç¨¿

## ã¯ã˜ã‚ã«

[AI Agent Hackathon with Google Cloud](https://zenn.dev/hackathons/2024-google-cloud-japan-ai-hackathon)ã«å‘ã‘ã¦ã€æŠ€è¡“ãƒ–ãƒ­ã‚°ã‚’å‹æ‰‹ã«ä½œã£ã¦ãã‚Œã‚‹AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸã€‚
ã€ŒAWSã¯è§¦ã£ãŸã“ã¨ã‚ã‚‹ã‘ã©ã€GCPã¯åˆã‚ã¦å±¤ã€ã ã£ãŸã®ã§ã€AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã ã‘ã§ãªãGCPã‚‚ã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—ã—ãªãŒã‚‰ã§æ¥½ã—ã‹ã£ãŸã§ã™ã€‚

## ãƒ¦ãƒ¼ã‚¶ãƒ¼åƒ

* ãƒ†ãƒƒã‚¯é ˜åŸŸã®é–‹ç™ºè€…
* æ–°è¦æŠ€è¡“æ´»ç”¨ã‚’æ±‚ã‚ã‚‰ã‚Œã¦ã„ã‚‹äº‹æ¥­ä¼šç¤¾ã®æ–°è¦äº‹æ¥­æ‹…å½“

â€»ã¾ãšã¯ã€è‡ªåˆ†ãŒæºã‚ã‚‹ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³é–¢é€£ã®ãƒˆãƒ”ãƒƒã‚¯ã«ç‰¹åŒ–ã—ã¦ã„ã¾ã™

## ãƒ¦ãƒ¼ã‚¶ãƒ¼åƒã«ãŠã‘ã‚‹èª²é¡Œ

æ—¥ã€…ã®ã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—ãŒã—ã‚“ã©ã„

* æ—¥æ¬¡ã§æ–°ã—ã„è¦æ ¼ã‚„ãƒˆãƒ¬ãƒ³ãƒ‰ãŒç”Ÿã¾ã‚Œã¦ãã‚‹ã€‚ã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—ã«æ±‚ã‚ã‚‰ã‚Œã‚‹ã‚¹ãƒ”ãƒ¼ãƒ‰ãŒã¨ã¦ã‚‚æ—©ã„
* è‹±èªã®è¨˜äº‹ãŒä¸»ã§ã‚ã‚Šã€ãŸã èª­ã‚€ã®ã«ã‚‚éª¨ãŒæŠ˜ã‚Œã‚‹

## ä»Šå›ä½œæˆã—ãŸã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

### æ¦‚è¦

ã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—ã—ãŸã„æƒ…å ±ã®ã‚¿ãƒã‚’å…¥åŠ›ã—ã¦ã„ã‘ã°ã€å‹æ‰‹ã«æŠ•ç¨¿ã¨å‘ŠçŸ¥ã‚’ã‚„ã£ã¦ãã‚Œã‚‹AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã€‚
ï¼ˆã›ã£ã‹ãæŠ•ç¨¿ã™ã‚‹ã®ã ã‹ã‚‰ã€å¤šãã®äººã«èª­ã‚“ã§ã»ã—ã„ã¨ã„ã£ãŸä¸‹å¿ƒãŒå«ã¾ã‚Œã¦ã„ã¾ã™ ç¬‘ï¼‰

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

æ©Ÿèƒ½ | ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  | åˆ©ç”¨ã‚µãƒ¼ãƒ“ã‚¹
--- | --- | --- 
Webã‚¢ãƒ—ãƒªãƒ›ã‚¹ãƒˆ | ï¼ˆä»Šå›æœªå®Ÿè£…ï¼‰ | ï¼ˆä»Šå›æœªå®Ÿè£…ï¼‰
èªè¨¼èªå¯ | Firebase | Authentication<br>ï¼ˆGithubèªè¨¼ï¼‰
DBï¼ˆæŠ•ç¨¿è¨­å®šï¼‰ | Firebase | Cloud Firestore
ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å‡¦ç†â‘ ï¼ˆæŠ•ç¨¿è¨­å®šä½œæˆï¼‰ | GCP | Cloud Run
ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å‡¦ç†â‘¡ï¼ˆæŠ•ç¨¿å‡¦ç†ã®ç®¡ç†ï¼‰|GCP |  Task Ques
ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å‡¦ç†â‘¢ï¼ˆæŠ•ç¨¿å‡¦ç†ï¼‰ | GCP | Cloud Functions
æ¨è«–ãƒ»è‡ªç„¶è¨€èªå‡¦ç† | GCP | Vertex AI

![ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³_raw](./architecture_00_raw.png)

### AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒæ‹…ã†å½¹å‰²

#### 1.ãƒ–ãƒ­ã‚°è¨˜äº‹ã®ç”Ÿæˆ

ãƒ–ãƒ­ã‚°ã®æœ¬æ–‡ã¨ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«ã‚’Verte AIã§ä½œæˆã€‚
æœ¬æ–‡ä½œæˆã®ãƒ¢ãƒ‡ãƒ«ã¯è‡ªåˆ†ã§åˆ†ã‹ã‚Šã‚„ã™ã„ã¨æ€ã£ã¦ã„ã‚‹æ–¹ã®æ–‡ç« ã‚’æ•™å¸«ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ã€æ•™å¸«ã‚ã‚Šãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’è¡Œã£ãŸã‚‚ã®ã‚’åˆ©ç”¨ã€‚

[/dai0kou-backend/functions/generate_setting/lib/prompt.py](../dai0kou-backend/functions/generate_setting/lib/prompt.py)

<details>

<summary>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆåˆ©ç”¨éƒ¨åˆ†</summary>

```python
...
def generateContents(source, count, digest):
    text = f"""
    ä»¥ä¸‹å†…å®¹ã‚’ã€ã‚ã‹ã‚Šã‚„ã™ãèª¬æ˜ã™ã‚‹ãƒ–ãƒ­ã‚°ã‚’ä½œæˆã—ã¦
    {source}

    ã¾ãŸã€ã“ã‚Œã¾ã§{str(count)}å›æŠ•ç¨¿ã—ã¦ãŠã‚Šã€å‰å›ã®è¨˜äº‹ã§ä¸‹è¨˜å†…å®¹ã¯æŠ•ç¨¿æ¸ˆã¿ã§ã‚ã‚‹ã“ã¨ã‚‚ç•™æ„ã—ã¦
    {digest}
    """
    print("Generation start!!!")

    request = {
        'contents': [
            {'role': 'user', 'parts': [text]}
        ],
    }
    vertexai.init(
        project="33517488829",
        location="us-east1",
        api_endpoint="us-east1-aiplatform.googleapis.com"
    )
    tools = [
        Tool.from_google_search_retrieval(
            google_search_retrieval=grounding.GoogleSearchRetrieval()
        ),
    ]
    model = GenerativeModel(
        "projects/33517488829/locations/us-east1/endpoints/7247149419508793344",
        tools=tools,
        system_instruction=["""ã‚ãªãŸã¯ãƒ–ãƒ­ã‚°æŠ•ç¨¿ã‚’è¡Œã†ä½œè€…ã§ã™ã€‚ä¸ãˆã‚‰ã‚ŒãŸæƒ…å ±ã®è¦ç´„ã ã‘ã§ãªãã€å°‚é–€å®¶ã¨ã—ã¦ã€æŠ€è¡“ã®æ´»ç”¨ã«å‘ã‘ãŸè€ƒå¯Ÿã‚’åŠ ãˆã¦ãã ã•ã„"""]
    )
    
    responses = model.generate_content(
        [text],
        generation_config=generation_config,
        safety_settings=safety_settings,
        stream=True,
    )
    
    print("Generation finished!!!")
    res_text = ""
    for response in responses:
        res_text = res_text + response.text

    responses = model.generate_content(
        [text],
        generation_config=generation_config,
        safety_settings=safety_settings,
        stream=True,
    )

    print("Generation finished!!!")
    res_text = ""
    for response in responses:
        res_text = res_text + response.text + '\n'
        
    return res_text
```

</details>

#### 2.å‘ŠçŸ¥æ–‡ã®ä½œæˆ

ã‚·ãƒ³ãƒ—ãƒ«ã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å©ã„ã¦æ–‡ç« ã‚’ä½œæˆ

[/dai0kou-backend/functions/post/main.py](../dai0kou-backend/functions/post/main.py)

<details>

<summary>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆåˆ©ç”¨éƒ¨åˆ†</summary>

```python
...
def generate_post(contents):
    text = f"""
    ä»¥ä¸‹å†…å®¹ã®ãƒ–ãƒ­ã‚°ã‚’æ›¸ã„ã¦ã„ã‚‹ã€‚Xã§å‘ŠçŸ¥ã™ã‚‹ãŸã‚ã®æ–‡ç« ã‚’100æ–‡å­—ä»¥å†…ã§ä½œæˆã—ã¦
    {contents}
    """
    
    request = {
        'contents': [
            {'role': 'user', 'parts': [text]}
        ],
    }
    vertexai.init(project="ai-agent-bamb00", location="asia-northeast1")
    model = GenerativeModel("gemini-1.5-flash-001",)
    
    responses = model.generate_content(
        [text],
        generation_config=generation_config,
        safety_settings=safety_settings,
        stream=True,
    )
    print("Generation finished!!!")
    res_text = ""
    for response in responses:
        res_text = res_text + response.text
    print(res_text)
    
    return res_text
...
```

</details>

â€»ä½œæˆã—ãŸæŠ•ç¨¿æ–‡ã¯X APIã§è¨˜äº‹ã®URLã¨åˆä½“ã•ã›ã¦æŠ•ç¨¿ã—ã¦ã„ã‚‹

```Python
...
# Post on X
print('start post on X')
post_body = generate_post(doc_dict["contents"][index]["body"])
post_content = f" {post_body} https://zenn.dev/bamb00eth/articles/{file_name}"
print('Post content ---')
print(post_content)
post_x(post_content)
...
```

### ãƒ‡ãƒ¢å‹•ç”»

![ãƒ‡ãƒ¢å‹•ç”»](https://youtu.be/FrnXRmP77Ag)

## ä»Šå›ä½œã‚Œãã‚Œãªã‹ã£ãŸã‚‚ã®

**è¨˜äº‹ã®ã‚¿ãƒã‚’URLã ã‘ã§å–ã‚Šè¾¼ã‚€**

* ä»Šå›ã€Webãƒšãƒ¼ã‚¸ã‚’ã‚³ãƒ”ãƒšã—ã¦èª­ã¾ã›ã¦ã„ã‚‹
* ã“ã‚Œã‚’URLæŒ‡å®š or ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã ã‘ã§ã‚ˆã—ãªã«è§£èª¬ã™ã¹ãå†…å®¹ã‚’æŠœãå‡ºã›ã‚‹ã‚ˆã†ã«ã—ãŸã‹ã£ãŸ

**è¨˜äº‹ä½œæˆã®ãƒ¢ãƒ‡ãƒ«ã®ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°**

* ã‚µãƒ³ãƒ—ãƒ«æ•°ãŒ30å¼±ãªã®ã§ã€ã›ã‚ã¦150ãã‚‰ã„ã¯ç”¨æ„ã—ãŸã‹ã£ãŸã€ã€
* ãƒ–ãƒ­ã‚°æœ¬æ–‡ã‚‚ä¸­ç«‹çš„ãªæ–‡ç« ãªã®ã§ã€ã‚‚ã£ã¨å°–ã£ãŸæ–‡ç« ã‚’ä½œæˆã§ãã‚‹ã‚ˆã†ã«ã—ãŸã„

**é…ä¿¡æ™‚é–“ã®æœ€é©åŒ–**

* ã‚ˆã‚Šã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ã‚’ç¨¼ã’ã‚‹æ™‚é–“ã«é…ä¿¡ã•ã›ãŸã‹ã£ãŸ

**Xä»¥å¤–ã§æŠ•ç¨¿ã™ã‚‹ãŸã‚ã®ã‚³ãƒã‚¯ã‚¿**

* ç¤¾å†…ã®Teamsã ã¨è…ã‚‹ã»ã©ãƒãƒ¼ãƒ ãŒã‚ã‚‹ã®ã§ã€ãªã‚‹ã¹ãèª­ã‚“ã§ã‚‚ã‚‰ã†äººãŒã„ã‚‹ãƒãƒ¼ãƒ ã«æŠ•ç¨¿ã•ã›ãŸã„

##
  オプティミスティックロールアップにおける相互運用性のセキュリティ上の考慮事項

このブログ
記事では、オプティミスティックロールアップ（ORU）における相互
運用性のセキュリティ上の考慮事項について、詳細に解説します。

### 信頼モデル

ORUにおける相互運用性の脆弱性は、開始メッセージが実際に
存在するように見え、実行メッセージの処理を促す場合に発生します。しかし、開始メッセージは最終的に標準的なチェーンに実際には表示されません。
L1のリオーグを除いて、これは次の2つの方法で発生する可能性があります。

* **偽装:** シーケンサーがゴシッププロトコルを使用して、最終的にL1に書き込まれるものとは異なるブロック
を公開します。この問題は、ゴシッププロトコルブロックに開始メッセージとして使用されるログエントリが含まれているが、実際のブロック（L1に書き込まれたもの）には含まれていない場合に発生します。この
処理方法は、安全でないブロックに依存するブロックは、それ自体が安全ではなくなります。依存するすべてのブロック（直接的または間接的）がL1にも書き込まれるまで、安全として扱われません。
* **誤った情報:** シーケンサーのオペレーターは、依存セット
内のすべてのチェーンに対して検証ノードを実行できます。その場合、すべてのチェーンの安全なトランザクションから開始メッセージを推測できます。リソースを節約するために、シーケンサーはソースブロックチェーンの既存のノードにクエリを実行することを選択できます。その場合、シーケンサーに提供される情報が
正しくない場合、シーケンサーが投稿するブロックも当然誤ります。

この場合、無効なブロックは、他の検証者によってデポジットのみのブロックに置き換えられます。

### デポジットのみのブロックとは？

デポジットのみのブロックは、実行メッセージを含まないブロック
です。これらのブロックは、シーケンサーが不正な情報に基づいてブロックを構築し、そのブロックに依存するすべての後続のブロックが無効になる場合に、ORUチェーンに書き込まれます。デポジットのみのブロックは、チェーンの状態を更新することなく、単に資金を
L2にデポジットするために使用されます。

### 待ち時間とセキュリティのトレードオフ

開始メッセージは、別のブロックチェーン上のブロックから取得されます。ゴシッププロトコルでブロックが利用可能になった時点で開始メッセージを受け入れると、待ち時間は最小限に抑えられますが、セキュリティ
上のコストが発生します（ソースシーケンサーはゴシップを通じて不正な情報を送信できるため）。または、ソースシーケンサーがブロックをL1に投稿するまで待つことができます。その場合、ブロックが正しいという確信度を高めることができますが、待ち時間が長くなります。

待ち時間とセキュリティの
レベルが異なる3つの可能性があります。

* **安全でない開始メッセージ:** L2ブロックは、安全ではなく、つまりL1の証拠がない状態で開始され、そのブロックチェーンのシーケンサーは不正な情報を送信できます。例えば、特定のトランザクションがブロックに含まれているが実際には含まれていない
ことを送信することを偽装といいます。相互運用性を備えたブロックを構築するシーケンサーは、最小限の待ち時間で、安全でないブロック（ゴシッププロトコルを通じて受信）からのメッセージを受け入れることを選択できます。

偽装のリスクを最小限に抑えるため、L1に書き込ま
れたブロック（ローカルセーフ）は、そのブロックとそのブロックチェーンのすべての先行ブロックがL1にも書き込まれるまで、完全に安全（クロスセーフ）と見なされます。ソースブロックが最初にL1に書き込まれると、宛先シーケンサーはそれを検出できます。ソースブロック
に、シーケンサーが偽装のために依存していた開始メッセージが欠落している場合、シーケンサーはエラーを特定し、状態を再計算できます。このシナリオでは、重大な被害は発生しません。

しかし、宛先ブロック（開始メッセージに依存する実行メッセージを含む）が最初にL1に
書き込まれると（例えば、チェーンのトラフィックが多い場合）、別のリスクが発生します。最終的にL1に書き込まれるソースブロックに開始メッセージが欠落している場合、検証者は宛先ブロックとそのブロックに依存するすべてのブロックの導出が正しくないことを検出します。この場合、宛先ブロック
とそのブロックに依存するすべてのチェーンの後続のブロックは、デポジットのみのブロックとして分類されます。

* **安全な開始メッセージ:** シーケンサーは、開始メッセージがクロスセーフなブロックにある場合にのみ、実行メッセージを受け入れるように構成できます。クロスセーフなブロックは、L
1に書き込まれたブロックであり、その依存関係（直接的または間接的、同じチェーンの以前のブロックの依存関係を含む）がすべてL1に書き込まれています。

ブロックがクロスセーフになると、ソースシーケンサーは偽装することはできず、L1のリオーグが発生
した場合にのみ、状態を再計算する必要があります。この強化されたセキュリティのコストは、メッセージが一方のブロックチェーンからもう一方のブロックチェーンに渡るまでに時間がかかることです。BaseやOP Mainnetなどのスループットの高いOP Stackチェーンは、約5分ごとにバッチを送信するため、
平均して開始メッセージが安全になるまでに約2.5分かかる場合があります。

このDuneダッシュボードを使用して、OP Stackチェーンがバッチを送信する頻度を確認できます。

* **確定された開始メッセージ:** シーケンサーは、開始メッセージが確定されるまで、つまりL1に永続的に書き
込まれ、リオーグの影響を受けなくなるまで、すべての実行メッセージを拒否するように構成することもできます。現在、これにより、メッセージの待ち時間に約15分追加されます。

### 安全と安全でないセキュリティの図

シーケンサーが安全でない開始メッセージを受け入れる場合でも、その開始メッセージ
に依存するシーケンサーが構築するブロックは、その開始メッセージを含むブロックがL1に書き込まれて安全になるまで、安全とはみなされません。

### 結論

ORUにおける相互運用性は、アプリケーション開発者に大きな可能性を提供しますが、セキュリティ上の考慮事項に注意することが重要です。
シーケンサーの偽装や誤った情報の可能性を軽減するために、シーケンサーは開始メッセージの安全性を慎重に評価する必要があります。待ち時間とセキュリティのトレードオフを理解することは、最適なセキュリティレベルを選択するために重要です。


## 前回の記事からの内容

前回の記事では、オ
プティミスティックロールアップ（ORU）の導入、その動作原理、そしてその利点について解説しました。

今回の記事では、前回の記事で述べられたORUの利点である相互運用性におけるセキュリティ上の考慮事項について、さらに詳しく解説していきます。


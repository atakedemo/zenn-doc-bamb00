---
title: "OP Stackを知る ~ ##
 イーサ
リアム vs OP Stack: 開発者が知るべき違い 

"
emoji: "🛠"
type: "tech" 
topics: []
published: true
---
Sonieumがニュースになっているので、改めてOP Stackをしっかり知ってみようと思い、書き始めました

##
 イーサリアムとOP Stackチェーンの違い：開発者が知るべきこと


OP Stackチェーンはイーサリアムと互換性のある仮想マシン(EVM)
を持つように設計されており、イーサリアムプロトコルへの変更は最小限に抑えられています。しかし、開発者が認識しておくべき、イーサリアム
とOP Stackチェーンの動作にはいくつかの小さな違いがあります。

**ブリッジング**

* **デポジットトランザクション:** L1には存在
せず、L2でのトランザクションをL1から開始する方法です。これは、ブリッジアプリケーションがL1のETHやトークンをL2のOP Stackチェーンに送るために重要な役割を果たします。
* **
引き出しトランザクションとフォールトプルーフ:** L2ロールアップの状態をL1に証明する方法です。多くの場合、ユーザーがトークンやETHをL1に引き出す際に使用されます。フォールトプ
ルーフは、引き出しトランザクションをL1に証明するメカニズムです。

**オペコード**

| オペコード | Solidity相当 | 動作 |
|---|---|---|
| COINBASE | block.coinbase | 現在のシーケンサーの料金ウォレットのアドレスを返します。
イーサリアムとほぼ同じですが、通常はブロックごとに値が変わらないという違いがあります。 |
| PREVRANDAO | block.prevrandao | 現在のL1オリジンブロックのL1のPREVRANDAO（最新のRANDAO）値を返します。 |
| ORIGIN | tx.
origin | トランザクションがL1のスマートコントラクトによってトリガーされたL1 ⇒ L2トランザクションの場合、tx.originはL1 ⇒ L2トランザクションをトリガーしたアドレスのエイリアスアドレスに設定されます。それ以外の場合は、このオペコードは通常
どおり動作します。 |
| CALLER | msg.sender | トランザクションがL1のスマートコントラクトによってトリガーされたL1 ⇒ L2トランザクションで、これが最初のコールフレーム（コントラクト間の内部トランザクションではなく）の場合、同じアドレスエイリアシング動作
が適用されます。 |

**アドレスエイリアシング**

アドレスエイリアシングは、スマートコントラクトからL1からL2に送信されるトランザクションの動作に影響を与える重要なセキュリティ機能です。クロスチェーントランザクションを扱う場合は、このセクションを注意深く読んでください。CrossChainMessenger
コントラクトは、内部的にアドレスエイリアシングを処理してくれることに注意してください。

* 外部所有アカウントからL1からL2にトランザクションを送信する場合、L2のトランザクション送信者のアドレスは、L1のトランザクション送信者のアドレスに設定されます。
*
 しかし、トランザクションがL1のスマートコントラクトによってトリガーされた場合、L2のトランザクション送信者のアドレスは異なります。

CREATEオペコードの動作により、同じアドレスを持ちながら異なるバイトコードを持つ、L1とL2の両方でコントラクトを作成することが可能です。
これらのコントラクトは同じアドレスを共有していますが、本質的に2つの異なるスマートコントラクトであり、同じコントラクトとして扱うことはできません。その結果、L1のスマートコントラクトからL1からL2に送信されたトランザクションの送信者は、L1のスマートコントラクトのアドレス
ではなく、L1のスマートコントラクトがL2のスマートコントラクトであるかのように動作することができません（2つのコントラクトは同じアドレスを共有しているため）。

このようななりすましが発生するのを防ぐために、L1のスマートコントラクトからL1からL2にトラン
ザクションを送信する場合、送信者のアドレスがわずかに変更されます。実際には、L1コントラクトアドレスから送信されたように見えるのではなく、L2トランザクションはL1コントラクトアドレスの「エイリアス」バージョンから送信されたように見えます。このエイリアスアドレスは、実際のL1コント
ラクトアドレスからの一定のオフセットであり、エイリアスアドレスはL2の他のアドレスと競合せず、元のL1アドレスはエイリアスアドレスから簡単に復元できます。

この送信者アドレスの変更は、L1のスマートコントラクトによって送信されたL2トランザクション
にのみ適用されます。その他のすべての場合、トランザクション送信者アドレスは、イーサリアムで使用されているのと同じルールに従って設定されます。

| トランザクションソース | 送信者アドレス |
|---|---|
| L2ユーザー（外部所有アカウント） | ユーザーのアドレス（イーサリアム
と同じ） |
| L1ユーザー（外部所有アカウント） | ユーザーのアドレス（イーサリアムと同じ） |
| L1コントラクト（OptimismPortal.depositTransactionを使用） | L1_contract_address + 0x111100000000
0000000000000000000000001111 |

**トランザクション**

* **トランザクション料金:** OP Stackチェーンでは、イーサリアムで予想される標準の実行ガスの料金に加えて、L1
データ料金を支払う必要があります。OP Stackのトランザクション料金に関するガイドを参照してください。
* **EIP-1559パラメータ:** OP Stackのベース料金は、イーサリアムと同様に、EIP-1559メカニズムによって計算されます。OP Stackで使用されるEIP-
1559パラメータは、チェーンごとに異なります。
* **Mempoolルール:** イーサリアムとは異なり、OP Stackチェーンにはパブリックmempoolはありません。OP Stackのmempoolは現在、シーケンサーのみが閲覧できます。シーケンサーは、mempoolの
トランザクションを優先料金順（最高料金が先）に実行します。

**チェーンの確定性**

* イーサリアムなどのL1とは異なり、OP Stackチェーンには、特定のL2ブロックの確定性の状態を示す、安全でないヘッド、安全なヘッド、および
確定されたヘッドがあります。フォールトプルーフは、L2ロールアップの確定性に影響を与えるのではなく、L1への引き出しトランザクションの確定性にのみ影響を与えます。

**次へ**

上記には、さまざまな役に立つツールへのリンクが含まれています。以下は、チェックしておくとよい
ツールやリンクの例です。

* **OP-viem:** OPチェーンの多くのユニークな機能を処理できるJSフレームワークです。OP Stackチェーン用のEthers.jsに似ています。
* **仕様:** より詳細な技術的な説明と例については、こちらを参照してください。

OP Stackチェーン
はイーサリアムとの互換性を重視していますが、開発者が認識しておくべき微妙な違いがあります。これらの違いを理解することで、開発者は安全で効率的なアプリケーションを構築することができます。


これからもクリプトに関連する記事を書いていきます！
        
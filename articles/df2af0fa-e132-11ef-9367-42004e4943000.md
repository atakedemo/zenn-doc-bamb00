##
 異なるブロックチェーン間の相互運用性におけるセキュリティ対策：安全なメッセージング
の重要性

この記事では、異なるブロックチェーン間の相互運用性において、安全な
メッセージングがいかに重要であるかを解説します。特に、**OP Stack** などの高スループットなチェーンにおける、** initiating message（開始メッセージ）**
 と **executing message（実行メッセージ）** の扱いについて詳しく説明します。

### 信頼モデルと相互運用性の脆弱性

相互運用性における
脆弱性は、開始メッセージが存在しているように見えても、実際には canonical chain（正式なチェーン）に反映されていない場合に発生します。

この問題は、以下の2つの方法で発生します。

1. **偽装:** シー
ケンサーが、ゴシッププロトコルを通じて L1 に書き込まれるものとは異なるブロックを公開する場合。ゴシッププロトコルで公開されたブロックには、開始メッセージとして使用されるログエントリーが含まれていても、実際に L1 に
書き込まれたブロックには含まれていないという問題が発生します。この場合、**unsafe block**（安全でないブロック）に依存するブロックは、**unsafe** とみなされます。そのブロックが安全として扱われるのは、直接または間接的に依存しているすべてのブロックが L1 に書き込まれたときです。

2. **誤った情報:** シーケンサーオペレーターは、依存セット内の各チェーンに対して検証ノードを実行できます。この場合、シーケンサーは各チェーンの安全なトランザクションから開始メッセージを推測できます。しかし、シーケンサーはリソース節約のために、ソースブロック
チェーンの既存のノードにクエリを送信することもできます。その場合、シーケンサーに提供された情報が正しくない場合、シーケンサーによって投稿されたブロックも正しくありません。

### 遅延とセキュリティのトレードオフ

開始メッセージは、別のブロックチェーンのブロックから取得
されます。

* ゴシッププロトコルを通じてブロックが利用可能になったらすぐに開始メッセージを受け入れると、遅延は最小限に抑えられますが、セキュリティ面でのリスクがあります（ソースシーケンサーがゴシップを通じて不正な情報を送信する可能性があるため）。
* ソースシーケンサーがブロックを
 L1 に投稿するまで待つと、ブロックが正しいことをより確信できますが、遅延が大きくなります。

これらのトレードオフを考慮して、以下の3つの選択肢があります。

1. **unsafe initiating messages:** 遅延が最小限ですが、セキュリティリスクが最も高い。
2.
 **safe initiating messages:** 遅延が中程度で、セキュリティリスクが低い。
3. **finalized initiating messages:** 遅延が最大ですが、セキュリティリスクが最小。

### unsafe initiating messages

シーケンサーは、**unsafe** な開始メッセージを受け入れるよう設定できます。

*
 **unsafe** な開始メッセージは、L1 での証拠がなく、そのブロックチェーンのシーケンサーが誤った情報を送信する可能性があります。
* 例えば、あるトランザクションがブロックに含まれていると誤って送信することが、**偽装** です。
* シーケンサーは、
最小限の遅延のために、**unsafe** なブロック（ゴシッププロトコルを通じて受信した）からのメッセージを受け入れることができます。

**偽装** を最小限に抑えるために、L1 に書き込まれたブロック（**local safe**）は、そのブロックと、そのブロックチェーンのすべての
先行ブロックが L1 に書き込まれた場合にのみ、完全に**safe**（**cross safe**）とみなされます。

* ソースブロックが最初に L1 に書き込まれる場合、宛先シーケンサーはそれを検出できます。
* ソースブロックに、シーケンサーが依存していた
開始メッセージが、偽装のために含まれていない場合、シーケンサーはエラーを特定し、状態を再計算できます。この場合、深刻な影響はありません。

ただし、宛先ブロック（開始メッセージに依存する実行メッセージを含む）が最初に L1 に書き込まれる場合（例えば、その
チェーンのトラフィックが大きい場合）、別のリスクが発生します。

* 最後に L1 に書き込まれるソースブロックに開始メッセージが含まれていない場合、検証者は宛先ブロックとその依存関係の導出が正しくないことを検出します。
* この場合、宛先ブロックとその後のチェーン上のすべての
依存ブロックは、**deposit-only blocks** と分類されます。

### safe initiating messages

シーケンサーは、開始メッセージが**cross safe**なブロックに含まれるまで、実行メッセージを受け入れないように設定できます。

* **cross safe**なブロックとは、L1 に書き込まれ、その
依存関係（直接的または間接的、同じチェーンの以前のブロックの依存関係を含む）がすべて L1 に書き込まれたブロックのことです。
* ブロックが**cross safe**になると、ソースシーケンサーは**偽装**を行うことができず、状態は L1 の再編成が発生
した場合にのみ再計算する必要があります。
* この強化されたセキュリティの代償として、メッセージが一方のブロックチェーンからもう一方のブロックチェーンに渡るまでに時間がかかります。
* Base や OP Mainnet などの高スループットな OP Stack チェーンは、約5分ごとにバッチを
提出するため、開始メッセージが安全になるまでに平均して約2.5分かかります。

### finalized initiating messages

シーケンサーは、開始メッセージが**finalized**されるまで、すべての実行メッセージを拒否するように設定することもできます。

* **finalized**とは、開始メッセージが L1 に
永続的に書き込まれ、再編成の影響を受けない状態のことです。
* 現在、これはメッセージの遅延を約15分追加します。

### 安全と非安全のセキュリティ図

シーケンサーが**unsafe**な開始メッセージを受け入れる場合でも、それらに依存する構築されたブロックは
、それらの開始メッセージを含むブロックが L1 に書き込まれ、**safe**になるまで、**unsafe**とみなされます。

### まとめ

この記事では、異なるブロックチェーン間の相互運用性における安全なメッセージングの重要性を解説しました。開始メッセージがどのように扱われるか、それに伴う
遅延とセキュリティのトレードオフについて、詳しく説明しました。

**unsafe**、**safe**、**finalized**の3つの選択肢があります。シーケンサーは、セキュリティと遅延のバランスを考慮して、適切な設定を選択する必要があります。
